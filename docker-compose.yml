"""
Dockerfile:
------------
FROM python:3.9-slim

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# Python deps
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Pre-descargar datos históricos para cache
RUN python -c "from app.trading.core import MarketHistoryAnalyzer; m = MarketHistoryAnalyzer(); m.fetch_or_load()"

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
"""

"""
docker-compose.yml:
-------------------
version: '3.8'

services:
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/titans
      - REDIS_URL=redis://redis:6379/0
      - SECRET_KEY=${SECRET_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - CUDA_AVAILABLE=false
    depends_on:
      - db
      - redis
      - worker

  worker:
    build: .
    command: celery -A app.worker.tasks worker --loglevel=info --concurrency=4
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/titans
      - REDIS_URL=redis://redis:6379/0
      - CUDA_AVAILABLE=false
    depends_on:
      - db
      - redis

  db:
    image: timescale/timescaledb:latest-pg14
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=titans
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

  # Opcional: Dashboard de Celery
  flower:
    image: mher/flower:latest
    environment:
      - CELERY_BROKER_URL=redis://redis:6379/0
    ports:
      - "5555:5555"
    depends_on:
      - redis

volumes:
  postgres_data:
  redis_data:
"""

"""
requirements.txt:
-----------------
fastapi==0.104.1
uvicorn[standard]==0.24.0
celery==5.3.4
redis==5.0.1
sqlalchemy==2.0.23
alembic==1.12.1
psycopg2-binary==2.9.9
python-dotenv==1.0.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
stripe==7.8.0
pydantic==2.5.2
torch==2.1.1
pandas==2.1.3
numpy==1.26.2
yfinance==0.2.28
ccxt==4.1.67
scikit-learn==1.3.2
scipy==1.11.4
prometheus-client==0.19.0
websockets==12.0
"""

# =============================================================================
# INICIALIZACIÓN
# =============================================================================

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
